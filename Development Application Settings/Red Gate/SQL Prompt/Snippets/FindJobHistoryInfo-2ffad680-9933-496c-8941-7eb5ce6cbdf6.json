{
  "id": "2ffad680-9933-496c-8941-7eb5ce6cbdf6",
  "prefix": "FindJobHistoryInfo",
  "description": "KM: This script finds agent job history and agent job info. Use it instead of the Job History / Log File Viewer",
  "body": "/**********************************************************************************************************************\r\n** Job History\r\n**********************************************************************************************************************/\r\nSELECT\r\n    /* Date             = dbo.agent_datetime(SJH.run_date, SJH.run_time) */\r\n    Date                = FORMAT(CONVERT(datetime, CONVERT(char(8), SJH.run_date, 112) + ' ' + STUFF(STUFF(RIGHT('000000' + CAST(SJH.run_time AS varchar(6)), 6), 3, 0, ':'), 6, 0, ':')), 'MM/dd/yyyy hh:mm:ss tt')\r\n   ,[Step ID]           = SJH.step_id\r\n   ,[Step Name]         = ISNULL(SJS.step_name, 'Job Status')\r\n   ,Status              = CASE SJH.run_status\r\n                              WHEN 0\r\n                                  THEN 'Failed'\r\n                              WHEN 1\r\n                                  THEN 'Succeeded'\r\n                              WHEN 2\r\n                                  THEN 'Retry'\r\n                              WHEN 3\r\n                                  THEN 'Canceled'\r\n                              WHEN 4\r\n                                  THEN 'In Progress'\r\n                              ELSE 'Unknown'\r\n                          END\r\n   ,[Job Name]          = SJ.name\r\n   ,Message             = SJH.message\r\n   ,Duration            = STUFF(STUFF(RIGHT('00000' + CAST(SJH.run_duration AS varchar(6)), 6), 3, 0, ':'), 6, 0, ':')\r\n   ,[Retries Attempted] = SJH.retries_attempted\r\nFROM\r\n    msdb.dbo.sysjobs                     AS SJ\r\nINNER JOIN msdb.dbo.sysjobhistory        AS SJH ON SJ.job_id     = SJH.job_id\r\nLEFT OUTER JOIN msdb.dbo.sysjobsteps     AS SJS ON SJH.job_id    = SJS.job_id\r\n                                           AND SJH.step_id  = SJS.step_id\r\nLEFT OUTER JOIN msdb.dbo.sysjobstepslogs AS SJSL ON SJS.step_uid = SJSL.step_uid\r\nWHERE\r\n    SJ.name = '[JOB-NAME]'\r\nORDER BY\r\n    SJH.run_date DESC\r\n   ,SJH.run_time DESC\r\n   ,SJH.step_id DESC;\r\nGO\r\n\r\nRETURN;\r\n\r\n/**********************************************************************************************************************\r\n** View Job Information\r\n**********************************************************************************************************************/\r\nSELECT\r\n    JobName     = SJ.name\r\n   ,Enabled     = SJ.enabled\r\n   ,StartStepId = SJ.start_step_id\r\n   ,StepId      = SJS.step_id\r\n   ,StepName    = SJS.step_name\r\n   ,Subsystem   = SJS.subsystem\r\n   ,Command     = SJS.command\r\n   ,OnSuccess   = CASE SJS.on_success_action\r\n                      WHEN 1\r\n                          THEN 'Quit with success'\r\n                      WHEN 2\r\n                          THEN 'Quit with failure'\r\n                      WHEN 3\r\n                          THEN 'Go to next step'\r\n                      WHEN 4\r\n                          THEN 'Go to step ' + CAST(SJS.on_success_step_id AS varchar(3))\r\n                      ELSE 'Unknown'\r\n                  END\r\n   ,OnFailure   = CASE SJS.on_fail_action\r\n                      WHEN 1\r\n                          THEN 'Quit with success'\r\n                      WHEN 2\r\n                          THEN 'Quit with failure'\r\n                      WHEN 3\r\n                          THEN 'Go to next step'\r\n                      WHEN 4\r\n                          THEN 'Go to step ' + CAST(SJS.on_fail_step_id AS varchar(3))\r\n                      ELSE 'Unknown'\r\n                  END\r\nFROM\r\n    msdb.dbo.sysjobs            AS SJ\r\nINNER JOIN msdb.dbo.sysjobsteps AS SJS ON SJ.job_id = SJS.job_id\r\nWHERE\r\n    SJ.name = '[JOB-NAME]';\r\nGO"
}