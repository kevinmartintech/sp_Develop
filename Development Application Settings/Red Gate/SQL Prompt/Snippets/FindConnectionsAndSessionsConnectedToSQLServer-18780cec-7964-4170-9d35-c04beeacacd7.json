{
  "id": "18780cec-7964-4170-9d35-c04beeacacd7",
  "prefix": "FindConnectionsAndSessionsConnectedToSQLServer",
  "description": "KM: Find Connections and Sessions Connected to SQL Server",
  "body": "SELECT DISTINCT\r\n    S.host_name\r\n   ,C.client_net_address\r\n   ,S.program_name\r\n   ,S.login_name\r\n   ,S.nt_domain\r\n   ,S.nt_user_name\r\n   ,S.client_interface_name\r\n   ,DatabaseName = D.name\r\nFROM\r\n    sys.dm_exec_sessions AS S\r\nINNER JOIN sys.databases AS D ON S.database_id = D.database_id\r\nLEFT JOIN sys.dm_exec_connections AS C ON C.session_id = S.session_id\r\nWHERE\r\n    S.login_name NOT IN (N'sa')\r\nAND S.program_name NOT IN (N'SQLServerCEIP')\r\nAND S.program_name NOT LIKE N'SQLAgent - %'\r\nORDER BY\r\n    S.login_name ASC;"
}