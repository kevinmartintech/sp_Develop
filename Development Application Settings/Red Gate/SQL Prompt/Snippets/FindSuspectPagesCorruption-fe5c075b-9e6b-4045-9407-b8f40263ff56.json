{
  "id": "fe5c075b-9e6b-4045-9407-b8f40263ff56",
  "prefix": "FindSuspectPagesCorruption",
  "description": "KM: Find Suspect Pages Corruption",
  "body": "/**********************************************************************************************************************\r\n** Query for Suspect Pages Corruption\r\n** https://learn.microsoft.com/en-us/sql/relational-databases/backup-restore/manage-the-suspect-pages-table-sql-server\r\n**********************************************************************************************************************/\r\nSELECT\r\n    DatabaseName     = D.name\r\n   ,LogicalFileName  = MF.name\r\n   ,PhysicalFileName = MF.physical_name\r\n   ,SP.page_id\r\n   ,EventType        = CASE SP.event_type\r\n                           WHEN 1\r\n                               THEN '823 error caused by an operating system CRC error or 824 error other than a bad checksum or a torn page (for example, a bad page ID)'\r\n                           WHEN 2\r\n                               THEN 'Bad Checksum'\r\n                           WHEN 3\r\n                               THEN 'Torn Page'\r\n                           WHEN 4\r\n                               THEN 'Restored (The page was restored after it was marked bad)'\r\n                           WHEN 5\r\n                               THEN 'Repaired (DBCC repaired the page)'\r\n                           WHEN 7\r\n                               THEN 'Deallocated by DBCC'\r\n                           ELSE 'Something New - Check the Microsoft Documentation'\r\n                       END\r\nFROM\r\n    dbo.suspect_pages       AS SP\r\nINNER JOIN sys.databases    AS D ON SP.database_id  = D.database_id\r\nINNER JOIN sys.master_files AS MF ON SP.file_id     = MF.file_id\r\n                                  AND D.database_id = MF.database_id;"
}