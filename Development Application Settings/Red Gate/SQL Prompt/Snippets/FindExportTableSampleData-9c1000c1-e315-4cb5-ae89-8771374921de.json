{
  "id": "9c1000c1-e315-4cb5-ae89-8771374921de",
  "prefix": "FindExportTableSampleData",
  "description": "KM: PowerShell Export Table Sample Data",
  "body": "#Install-Module sqlserver\r\n\r\n$ServerInstance = \"VENSSQL02\"\r\n$Database = \"VentureAccess\"\r\n$Path = \"C:\\Export\"\r\n$TableListQuery = \"SELECT\r\n    SchemaTableName = S.name + '.' + T.name\r\n    ,SchemaTableNameCleaned = REPLACE(S.name, '\\', '') + '.' + REPLACE(T.name, '\\', '')\r\nFROM\r\n    sys.tables         AS T\r\nINNER JOIN sys.schemas AS S ON T.schema_id = S.schema_id\r\nWHERE\r\n    S.Name NOT IN ('HangFire', 'CORP\\HJGower')\r\nORDER BY\r\n    T.name ASC;\"\r\n$TableDataQuery = \"SELECT TOP (1000) * FROM $SchemaTableName TABLESAMPLE (1500 ROWS);\"\r\n\r\n\r\n$Tables = invoke-sqlcmd  -database $Database -TrustServerCertificate -serverinstance $ServerInstance -query $TableListQuery\r\n  \r\n foreach ($Table in $Tables)\r\n {\r\n     $SchemaTableName = $Table[\"SchemaTableName\"]\r\n     $SchemaTableNameCleaned = $Table[\"SchemaTableNameCleaned\"]\r\n     $Query = \"SELECT TOP (1000) * FROM $SchemaTableName TABLESAMPLE (1500 ROWS);\"\r\n     \r\n     write-host -ForegroundColor White \"Creating File $SchemaTableNameCleaned.csv | $Query\"\r\n     invoke-sqlcmd -query $Query -database $Database -TrustServerCertificate -serverinstance $ServerInstance |export-csv -path $Path\\$SchemaTableNameCleaned.csv -NoTypeInformation\r\n }"
}